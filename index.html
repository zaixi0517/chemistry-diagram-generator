<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>åŒ–å­¦æ¦‚å¿µåŠ¨æ€ç¤ºæ„å›¾ç”Ÿæˆå™¨</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #ecf0f1; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 20px; }
        
        #search-area { display: flex; margin-bottom: 30px; }
        #conceptInput { flex-grow: 1; padding: 12px; border: 2px solid #bdc3c7; border-radius: 6px 0 0 6px; font-size: 16px; }
        #searchButton { padding: 12px 25px; background-color: #3498db; color: white; border: none; border-radius: 0 6px 6px 0; cursor: pointer; font-size: 16px; transition: background-color 0.3s; }
        #searchButton:hover { background-color: #2980b9; }

        .case-studies { margin-bottom: 40px; }
        .case-studies h3 { color: #34495e; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 15px; }
        .case-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 15px; }
        .case-card { background-color: #f7f9fb; padding: 15px; border-radius: 8px; border: 1px solid #dfe6e9; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; }
        .case-card:hover { transform: translateY(-3px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .case-card p { margin: 0; font-size: 14px; color: #7f8c8d; }
        .case-card strong { color: #2c3e50; display: block; margin-bottom: 5px; }

        #visualization-title { color: #2c3e50; margin-top: 20px; border-bottom: 2px solid #3498db; padding-bottom: 10px; display: none; }
        #visualizationResult { 
            min-height: 400px; 
            border: 1px dashed #bdc3c7; 
            border-radius: 8px; 
            padding: 20px; 
            display: flex; 
            flex-direction: column;
            justify-content: center; 
            align-items: center; 
            text-align: center;
            font-size: 18px;
            color: #7f8c8d;
            background-color: #ecf0f1;
        }

        /* åŠ è½½åŠ¨ç”» CSS */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>âš—ï¸ åŒ–å­¦æ¦‚å¿µåŠ¨æ€ç¤ºæ„å›¾ç”Ÿæˆå™¨</h1>

        <div id="search-area">
            <input type="text" id="conceptInput" placeholder="è¯·è¾“å…¥æ‚¨æƒ³ç”Ÿæˆçš„åŒ–å­¦ç¤ºæ„å›¾æ¦‚å¿µï¼Œå¦‚ï¼šç‰©è´¨ä¸‰æ€å˜åŒ–ä¸‹å¾®ç²’çš„å˜åŒ–ç¤ºæ„å›¾">
            <button id="searchButton" onclick="triggerGeminiSearch()">ç”Ÿæˆç¤ºæ„å›¾</button>
        </div>

        <div class="case-studies">
            <h3>âœ¨ å¸¸è§æœç´¢æ¡ˆä¾‹ (ç‚¹å‡»å³å¯å¡«å……)</h3>
            <div class="case-grid">
                <div class="case-card" onclick="fillInput('æ°´çš„ç”µç¦»è¿‡ç¨‹ï¼ˆåŠ¨æ€ï¼‰')">
                    <strong>æ°´çš„ç”µç¦»è¿‡ç¨‹</strong>
                    <p>å±•ç¤º H2O â‡„ H+ + OH- çš„å¾®è§‚åŠ¨æ€å¹³è¡¡ã€‚</p>
                </div>
                <div class="case-card" onclick="fillInput('HClåˆ†å­ä¸H2Oåˆ†å­çš„ä½œç”¨')">
                    <strong>HCl ä¸æ°´åˆ†å­ä½œç”¨</strong>
                    <p>è´¨å­è½¬ç§»å½¢æˆ H3O+ å’Œ Cl- çš„åŠ¨ç”»ã€‚</p>
                </div>
                <div class="case-card" onclick="fillInput('é“œé”ŒåŸç”µæ± å·¥ä½œåŸç†')">
                    <strong>é“œé”ŒåŸç”µæ± åŸç†</strong>
                    <p>ç”µå­æµåŠ¨ã€ç¦»å­è¿ç§»å’Œç”µæååº”çš„ç¤ºæ„å›¾ã€‚</p>
                </div>
                <div class="case-card" onclick="fillInput('ç‰©è´¨ä¸‰æ€å˜åŒ–å¾®ç²’ç¤ºæ„å›¾')">
                    <strong>ç‰©è´¨ä¸‰æ€å˜åŒ–</strong>
                    <p>å›ºã€æ¶²ã€æ°”çŠ¶æ€ä¸‹å¾®ç²’æ’åˆ—å’Œè¿åŠ¨çš„å¯¹æ¯”ã€‚</p>
                </div>
            </div>
        </div>
        
        <h3 id="visualization-title">ç”Ÿæˆç»“æœï¼šåŠ¨æ€ç¤ºæ„å›¾</h3>

        <div id="visualizationResult">
            åœ¨æ­¤å¤„å°†å±•ç¤ºç”± Gemini ç”Ÿæˆçš„åŠ¨æ€æˆ–äº¤äº’å¼åŒ–å­¦ç¤ºæ„å›¾ã€‚
        </div>
    </div>

    <script>
        const visualizationResult = document.getElementById('visualizationResult');
        const visualizationTitle = document.getElementById('visualization-title');
        const searchButton = document.getElementById('searchButton');
        const conceptInput = document.getElementById('conceptInput');

        function fillInput(concept) {
            conceptInput.value = concept;
        }

        function triggerGeminiSearch() {
            const concept = conceptInput.value;
            if (!concept) {
                alert("è¯·è¾“å…¥ä¸€ä¸ªåŒ–å­¦æ¦‚å¿µï¼");
                return;
            }
            
            // ç¦ç”¨æŒ‰é’®ï¼Œæ˜¾ç¤ºåŠ è½½çŠ¶æ€
            searchButton.disabled = true;
            searchButton.textContent = "ç”Ÿæˆä¸­...";
            visualizationTitle.style.display = 'block';

            // 1. æ›´æ–° UI ä¸ºåŠ è½½çŠ¶æ€
            visualizationResult.innerHTML = `
                <div style="padding: 50px;">
                    <div class="spinner"></div> 
                    <p>æ­£åœ¨è°ƒç”¨æ™ºèƒ½æ¨¡å‹ç”Ÿæˆ **${concept}** çš„åŠ¨æ€ç¤ºæ„å›¾...</p>
                </div>`;
            

            // 2. å‘èµ· Fetch è¯·æ±‚åˆ°åç«¯ä»£ç† 
            // ğŸŒŸ å…³é”®ï¼šä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œç¡®ä¿æœ¬åœ°å’Œéƒ¨ç½²ç¯å¢ƒéƒ½èƒ½å·¥ä½œ
            fetch('/generate_diagram', { 
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ concept: concept })
            })
            .then(response => {
                if (!response.ok) {
                    // å¦‚æœåç«¯è¿”å› 4xx/5xx é”™è¯¯ï¼Œå°è¯•è§£æ JSON é”™è¯¯æ¶ˆæ¯
                    return response.json().then(err => {
                        throw new Error(err.error || 'ç½‘ç»œè¯·æ±‚å¤±è´¥æˆ–åç«¯æœåŠ¡é”™è¯¯ã€‚');
                    }).catch(() => {
                        // å¦‚æœæ— æ³•è§£æ JSONï¼Œå¯èƒ½æ˜¯åç«¯å´©æºƒæˆ–è¿”å›äº†é JSON é”™è¯¯é¡µé¢
                        throw new Error(response.statusText || 'åç«¯æœåŠ¡è¿æ¥ä¸­æ–­ã€‚');
                    });
                }
                // Gemini è¿”å›çš„æ˜¯çº¯æ–‡æœ¬ (HTMLä»£ç )
                return response.text(); 
            })
            .then(htmlContent => {
                // 3. æˆåŠŸï¼šå°† Gemini è¿”å›çš„ HTML ä»£ç æ³¨å…¥åˆ° DOM ä¸­
                if (htmlContent && htmlContent.trim().length > 10) {
                    visualizationResult.innerHTML = htmlContent;
                    console.log("ä»£ç æ³¨å…¥æˆåŠŸï¼");
                } else {
                    // å¤„ç†è¿”å›ç©ºå†…å®¹çš„æƒ…å†µ
                    visualizationResult.innerHTML = `
                        <p style="color: orange; font-weight: bold;">ç”Ÿæˆç»“æœä¸ºç©ºæˆ–ä¸å®Œæ•´ã€‚</p>
                        <p>è¯·å°è¯•å…¶ä»–æ¦‚å¿µæˆ–æ£€æŸ¥åç«¯æ—¥å¿—ã€‚</p>`;
                }
            })
            .catch(error => {
                // 4. å¤±è´¥ï¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                console.error('APIè°ƒç”¨é”™è¯¯:', error);
                visualizationResult.innerHTML = `
                    <p style="color: red; font-weight: bold;">é”™è¯¯ï¼šæ— æ³•å®Œæˆç¤ºæ„å›¾ç”Ÿæˆã€‚</p>
                    <p>è¯·ç¡®ä¿ Flask åç«¯å·²å¯åŠ¨ä¸”ç«¯å£æ­£ç¡®ï¼Œæˆ–æ£€æŸ¥API Keyæ˜¯å¦æœ‰æ•ˆã€‚</p>
                    <p style="font-size: 14px;">è¯¦æƒ…ï¼š${error.message}</p>`;
            })
            .finally(() => {
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                searchButton.disabled = false;
                searchButton.textContent = "ç”Ÿæˆç¤ºæ„å›¾";
            });
        }
    </script>
</body>
</html>